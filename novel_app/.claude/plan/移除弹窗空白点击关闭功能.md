# 移除弹窗空白点击关闭功能 - 执行计划

## 任务概述
- **目标**：移除所有弹窗的点击空白区域关闭功能，确保用户只能通过明确按钮关闭弹窗
- **方案**：全局统一修改策略，创建DialogHelper工具类统一管理
- **范围**：影响7个文件，约15-20个弹窗实例

## 上下文信息
- **技术栈**：Flutter 3.0+，Dart SDK
- **项目类型**：小说阅读移动应用
- **弹窗类型**：Dialog/AlertDialog，自定义Dialog，PopupMenuButton，SnackBar

## 详细实施步骤

### 步骤1：创建统一弹窗工具类
**文件**：`lib/utils/dialog_helper.dart`
- 创建标准化的弹窗方法，预设barrierDismissible: false
- 提供showConfirmDialog(), showInputDialog(), showSelectionDialog()等API
- 确保所有弹窗都有标准的行为模式

### 步骤2：修改角色管理相关弹窗
**文件**：
- `lib/widgets/character_preview_dialog.dart`
- `lib/widgets/character_input_dialog.dart`
- `lib/widgets/character_selector.dart`

**操作**：
- 替换showDialog调用为新的工具类方法
- 移除默认的barrierDismissible参数（默认为false）
- 保留现有的UI布局和业务逻辑

### 步骤3：修改阅读器弹窗
**文件**：`lib/screens/reader_screen.dart`

**目标弹窗**：
- 字体大小设置弹窗（_showFontSizeDialog()）
- 搜索匹配详情弹窗（_showSearchMatchDialog()）
- 确认AI相关弹窗已正确设置barrierDismissible: false

### 步骤4：修改书架管理弹窗
**文件**：`lib/screens/bookshelf_screen.dart`

**目标弹窗**：
- 删除确认弹窗
- 背景设定编辑弹窗（_showBackgroundSettingDialog()）

### 步骤5：修改角色管理弹窗
**文件**：`lib/screens/character_management_screen.dart`

**目标弹窗**：
- 删除所有角色确认弹窗

### 步骤6：代码质量检查和测试
- 确保所有弹窗都设置了barrierDismissible: false
- 验证所有关闭按钮功能正常
- 运行flutter analyze检查代码质量
- 手动测试各类弹窗的关闭行为

## 关键设计原则
1. **最小侵入性**：只修改弹窗关闭行为，不影响现有业务逻辑
2. **向后兼容**：保持现有的API签名和返回值
3. **统一标准**：所有弹窗使用相同的barrierDismissible设置
4. **代码复用**：通过工具类减少重复代码

## 预期影响
- **修改文件数量**：7个文件（1个新建，6个修改）
- **用户体验提升**：避免误触关闭，操作更明确
- **代码维护性**：统一的弹窗管理，便于后续扩展

## 风险控制
- **保留现有逻辑**：不改变除关闭行为外的任何功能
- **充分测试**：每个修改的弹窗都要进行手动测试
- **可回滚性**：如遇问题可快速回滚到原始实现