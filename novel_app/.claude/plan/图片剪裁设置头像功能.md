# 图片剪裁设置头像功能 - 实施计划

## 任务目标
在图集浏览页面的"设置为头像"功能基础上，添加图片剪裁功能，让用户可以选择方形区域设置头像。

## 技术方案
使用 `image_cropper` 插件实现图片裁剪功能，替代现有的直接设置头像逻辑。

## 实施步骤

### 步骤 1：依赖管理
- 修改 `pubspec.yaml` 添加 `image_cropper: ^8.0.2`
- 执行 `flutter pub get`

### 步骤 2：创建图片裁剪服务
- 新建 `lib/services/image_crop_service.dart`
- 实现 `cropImageForAvatar()` 方法
- 处理方形裁剪、尺寸限制、质量优化

### 步骤 3：修改图集查看页面
- 修改 `lib/screens/gallery_view_screen.dart` 中的 `_onSetAsAvatar()` 方法
- 集成裁剪流程：原图 → 裁剪 → 设置头像
- 保持现有的错误处理和用户反馈机制

### 步骤 4：UI交互优化
- 添加裁剪过程的加载状态
- 优化用户取消操作处理
- 保持页面状态一致性

## 修改文件
1. `pubspec.yaml` - 添加依赖
2. `lib/screens/gallery_view_screen.dart` - 修改设置头像逻辑

## 新增文件
1. `lib/services/image_crop_service.dart` - 图片裁剪服务

## 技术细节
- 裁剪比例：1:1 方形
- 头像尺寸：最大 512x512
- 图片质量：85%
- 支持 Android 和 iOS 原生裁剪界面

## 预期效果
用户在图集页面点击"设置为头像"时，可以：
1. 看到原生裁剪界面
2. 选择方形区域
3. 预览裁剪效果
4. 确认后设置为角色头像