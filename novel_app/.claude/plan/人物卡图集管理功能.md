# 人物卡图集管理功能开发计划

## 任务描述
在人物卡管理页面实现图集功能：左上角显示首图，点击进入全屏浏览，支持左右滑动和底部操作（删除、多来几张、置顶）。

## 技术架构
- 基于现有 Flutter 技术栈
- Provider 状态管理
- 多级缓存（内存+磁盘）
- PageView 图片浏览
- 完整的 API 集成

## 实施步骤

### 步骤 1：扩展 ApiServiceWrapper 添加图集相关方法
- 文件：`lib/services/api_service_wrapper.dart`
- 添加图集 CRUD 操作方法
- 统一错误处理

### 步骤 2：创建图集数据模型
- 文件：`lib/models/role_gallery.dart`
- 定义 RoleGallery 和 RoleImage 模型
- 实现排序和过滤逻辑

### 步骤 3：创建图集缓存服务
- 文件：`lib/services/role_gallery_cache_service.dart`
- 多级缓存管理
- 智能清理和预加载

### 步骤 4：创建图片重试组件
- 文件：`lib/widgets/image_retry_widget.dart`
- 加载失败重试机制

### 步骤 5：创建图集缩略图组件
- 文件：`lib/widgets/gallery_thumbnail.dart`
- 首图显示和点击交互

### 步骤 6：创建图集浏览页面
- 文件：`lib/screens/gallery_view_screen.dart`
- 全屏浏览和手势交互

### 步骤 7：实现底部操作面板
- 文件：`lib/widgets/gallery_action_panel.dart`
- 三个操作按钮实现

### 步骤 8-10：实现具体功能
- 删除、多来几张、置顶功能

### 步骤 11：集成到人物卡管理
- 文件：`lib/screens/character_management_screen.dart`
- 完整用户体验流程

### 步骤 12-13：依赖配置和测试优化

## API 接口
- GET /api/role-card/gallery/{role_id}
- DELETE /api/role-card/image
- POST /api/role-card/regenerate

## 核心依赖
- cached_network_image
- path_provider
- provider